=== 本地执行的
创建虚拟环境
python -m venv .venv

进入虚拟环境
.venv\Scripts\activate.ps1

安装复读机插件echo
pip install nonebot-plugin-echo

导出依赖列表
pip freeze > requirements.txt


=== 部署服务器linux
先更新服务器的apt（ubuntu）
sudo apt update
sudo apt install -y \
    pkg-config \
    libmysqlclient-dev \
    default-libmysqlclient-dev \
    python3-dev \
    gcc

创建虚拟环境
python3 -m venv twipenv

服务器虚拟环境
source twipenv/bin/activate

退出虚拟环境
deactivate

安装依赖
pip install -r requirements.txt

其它需要手动安装的依赖
pip install mysqlclient
pip install Pillow
pip install httpx

检查依赖
pip freeze

直接停掉某个端口下的程序
lsof -t -i:8095 | xargs kill -9 2>/dev/null || echo "端口没有被占用"

启动机器人
nohup python bot.py > bot.log 2>&1 &

=== 其它
安装mysql
docker pull mysql:8
docker run --name=twip-mysql -e MYSQL_ROOT_PASSWORD=密码 -p 3306:3306 -d mysql:8

服务器安装mysql依赖的时候需要执行的
sudo apt-get update
sudo apt-get install python3-dev default-libmysqlclient-dev build-essential

加权限
chmod +x start_bot.sh

安装napcat
sudo docker run -d \
  -e NAPCAT_GID=$(id -g) \
  -e NAPCAT_UID=$(id -u) \
  -p 8095:8095 \
  -p 6099:6099 \
  -p 9501:9501 \
  -p 9502:9502 \
  -p 9503:9503 \
  --add-host=host.docker.internal:host-gateway \
  --name napcat3 \
  --restart=always \
  -v /root/bot/twip-napcat-cache/napcat_data:/app/data \
  -v /root/bot/twip-napcat-cache/napcat_cache:/app/cache \
  -v /root/bot/twip-napcat-cache/napcat_config:/app/config \
  docker.1ms.run/mlikiowa/napcat-docker:latest

# 访问napcat
http://你的服务器IP:6099/webui/web_login


# 添加权限
chmod +x ./start_bot.sh

# 启动
./start_bot.sh start

# 停止
./start_bot.sh stop

# 重启
./start_bot.sh restart

# 查看状态
./start_bot.sh status


我是<ft color=(224,164,25)>七画</ft>，今天吃了<ft color=(224,164,25)>蛋炒饭</ft>，味道不错！

我是<ft color=(224,164,25)>七画
，今天吃了<ft color=(224,164,25)>蛋炒饭
，味道不错！


我是<ft color=(224,164,25)>七画

find <ft(.*)> 会得到一个对象
然后去group(1)获取第一个捕获组，然后根据空格分开，这样可以做到多个自定义属性同时解析
可以得到color=(224,164,25)
分割=得到[0]=color 和[1]=(224,164,25)
走对应的标签解析器里面存起来
到此 你已经解析了标签内的所有自定义属性

然后span()这个正则，获取正则表达式匹配到的子字符串在整个原字符串中的起始和结束位置
然后切割得到标签内文本内容（右边）[:start]
反向切割得到标签外文本内容（左边）[end:]

至此 我是<ft color=(224,164,25)>七画 就解析完毕了


视频配置：腾讯云（2c2g3m）、本地电脑win11、连接服务器：WindTerm

部署流程：
1.安装docker（我的是腾讯云的docker镜像，自带docker了）
2.本地下好代码丢到服务器里面
3.服务器安装虚拟环境
4.进入虚拟环境安装依赖
5.通过docker部署下载napcat
6.启动napcat后本地进入页面访问http://你的服务器IP:6099/webui/web_login 进入控制台
7.在控制台内添加网络配置（告诉napcat机器人的通信地址）
8.去机器人根目录.env配置超级管理员，如果没有这个文件请参考.env.template
8.重启机器人

基本命令：
兑换 <兑换码>
绑定 <你的游戏昵称>
删除绑定
兑换全部

（超级管理员）基本命令：
兑换码列表
添加兑换码 <兑换码> <描述> <yyyy-MM-dd（有效时间）/永久>
删除兑换码 <兑换码>



